(self.webpackChunkchatsubo=self.webpackChunkchatsubo||[]).push([[429],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return m}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),u=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(t),m=r,N=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return t?a.createElement(N,o(o({ref:n},c),{},{components:t})):a.createElement(N,o({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=t[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},1743:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var a=t(2122),r=t(9756),i=(t(7294),t(3905)),o=["components"],s={},l="Introduction",u={unversionedId:"Acc\xe8s VPN/index",id:"Acc\xe8s VPN/index",isDocsHomePage:!1,title:"Introduction",description:"Afin de faciliter la gestion du r\xe9seau et l'acc\xe8s des joueurs aux instances, deux applications de gestion d'acc\xe8s VPN sont mises \xe0 disposition.",source:"@site/docs/30-Acc\xe8s VPN/00-index.md",sourceDirName:"30-Acc\xe8s VPN",slug:"/Acc\xe8s VPN/index",permalink:"/docs/Acc\xe8s VPN/index",editUrl:"https://github.com/chatsuboctf/chatsubo/docs/30-Acc\xe8s VPN/00-index.md",version:"current",sidebarPosition:0,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/docs/Providers/Proxmox/installation"},next:{title:"Installation",permalink:"/docs/Acc\xe8s VPN/installation"}},c=[{value:"Realms",id:"realms",children:[{value:"Cas concret",id:"cas-concret",children:[]}]},{value:"Configuration",id:"configuration",children:[{value:"Pont VPN",id:"pont-vpn",children:[]},{value:"Chatsubo",id:"chatsubo",children:[]}]}],p={toc:c};function d(e){var n=e.components,t=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"Afin de faciliter la gestion du r\xe9seau et l'acc\xe8s des joueurs aux instances, deux applications de gestion d'acc\xe8s VPN sont mises \xe0 disposition."),(0,i.kt)("p",null,"Ces applications se composent d'un client VPN de la technologie souhait\xe9e et d'un serveur l\xe9ger effectuant un suivi des acc\xe8s distribu\xe9s et servant une API afin de communiquer avec la plateforme."),(0,i.kt)("p",null,"Un fichier docker-compose regroupe le tout pour un d\xe9ploiement simplifi\xe9."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Les fichiers de configuration des joueurs leurs sont accessibles \xe0 tout moment via l'interface web.")),(0,i.kt)("h2",{id:"realms"},"Realms"),(0,i.kt)("p",null,"Il est possible de configurer plusieurs ponts VPN ; chaque pont VPN correspond \xe0 un ",(0,i.kt)("inlineCode",{parentName:"p"},"realm"),". Ces realms seront par la suite attach\xe9s aux diff\xe9rents providers via la clef ",(0,i.kt)("inlineCode",{parentName:"p"},"realms:"),"."),(0,i.kt)("p",null,"De cette mani\xe8re :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Un joueur peut acc\xe9der aux instances g\xe9r\xe9es par plusieurs providers depuis un m\xeame ",(0,i.kt)("inlineCode",{parentName:"li"},"realm")," de mani\xe8re transparente"),(0,i.kt)("li",{parentName:"ul"},"Un m\xeame challenge peut \xeatre instanci\xe9 dans plusieurs ",(0,i.kt)("inlineCode",{parentName:"li"},"realms")," diff\xe9rents")),(0,i.kt)("h3",{id:"cas-concret"},"Cas concret"),(0,i.kt)("h4",{id:"saturation-dun-pont-vpn"},"Saturation d'un pont VPN"),(0,i.kt)("p",null,"Dans le sc\xe9nario suivant : "),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"250 joueurs sont actifs via le pont VPN accessible via ",(0,i.kt)("em",{parentName:"p"},"one.chatsubo.wz")," et les 254 acc\xe8s pr\xe9-g\xe9n\xe9r\xe9s sont bient\xf4t \xe9puis\xe9s."),(0,i.kt)("p",{parentName:"blockquote"},"Le portail utilise WireGuard sur le sous-r\xe9seau 10.10.10.0/24.")),(0,i.kt)("p",null,"Dans cette situation, il suffit de d\xe9ployer, sur la m\xeame machine, une nouvelle instance de ",(0,i.kt)("inlineCode",{parentName:"p"},"chatsubo-gate-wg")," configur\xe9e sur le sous-r\xe9seau 10.10.20.0/24 et accessible via le nom de domaine ",(0,i.kt)("em",{parentName:"p"},"second.chatsubo.wz")," pour que 254 nouveaux acc\xe8s soient disponibles aux joueurs via le ",(0,i.kt)("inlineCode",{parentName:"p"},"realm"),' "second.chatsubo.wz".'),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Ne pas oublier d'ajouter la route avec le nouveau sous-r\xe9seau pour que la connexion du joueur puisse \xeatre rout\xe9e vers l'adresse IP que lui donne le VPN."),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sudo ip route add 10.10.20.0/24 via 10.10.10.X"))))),(0,i.kt)("h4",{id:"instances-redondantes"},"Instances redondantes"),(0,i.kt)("p",null,"Dans le sc\xe9nario suivant :"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Une machine h\xe9berg\xe9e par un Proxmox semble instable et l'on souhaite donner la possibilit\xe9 aux joueurs de basculer sur une nouvelle instance sans avoir \xe0 toucher \xe0 la premi\xe8re.")),(0,i.kt)("p",null,"La versatilit\xe9 de la configuration des ",(0,i.kt)("inlineCode",{parentName:"p"},"realms")," nous permet de d\xe9ployer deux instances du m\xeame challenge sur le m\xeame hyperviseur et de leur attribuer deux ",(0,i.kt)("inlineCode",{parentName:"p"},"realms")," diff\xe9rents."),(0,i.kt)("p",null,"Pour cet exemple, nous utiliserons les ",(0,i.kt)("inlineCode",{parentName:"p"},"realms")," ",(0,i.kt)("em",{parentName:"p"},"wz01")," et ",(0,i.kt)("em",{parentName:"p"},"wz02"),"."),(0,i.kt)("p",null,"Puisqu'il est possible d'assigner un m\xeame pont VPN \xe0 plusieurs ",(0,i.kt)("inlineCode",{parentName:"p"},"realms")," diff\xe9rents, il suffit de lui attribuer deux ",(0,i.kt)("inlineCode",{parentName:"p"},"realms")," diff\xe9rents pour donner acc\xe8s au joueur aux deux instances \xe0 la fois, chacune sur un ",(0,i.kt)("inlineCode",{parentName:"p"},"realm")," diff\xe9rent."),(0,i.kt)("p",null,"Ci-dessous un exemple de configuration permettant cette architecture :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'providers:\n  pve:\n   wz_pve:\n    api:\n      user: "api@pve"\n      host: "X.X.X.X"\n      port: 8006\n      token:\n        name: "changeme"\n        value: "changeme"\n    realms:\n      - "wz01"\n      - "wz02"\n\nvpns:\n - realm: "wz01"\n   url: "http://chatsubo.wz:7474"\n   token: "CHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEME"\n\n - realm: "wz02"\n   url: "http://chatsubo.wz:7474"\n   token: "CHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEME"\n\n')),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Il sera \xe9galement n\xe9cessaire de configurer les deux instances en indiquant dans leur ",(0,i.kt)("inlineCode",{parentName:"p"},"Note")," respectives ",(0,i.kt)("inlineCode",{parentName:"p"},"chatsubo.realm=first.chatsubo.wz")," et ",(0,i.kt)("inlineCode",{parentName:"p"},"chatsubo.realm=second.chatsubo.wz"),"."))),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"Quelques lignes de configurations sont n\xe9cessaires afin que la plateforme et le pont VPN puisse communiquer."),(0,i.kt)("h3",{id:"pont-vpn"},"Pont VPN"),(0,i.kt)("p",null,"Du c\xf4t\xe9 du pont VPN, il faut renseigner le ",(0,i.kt)("inlineCode",{parentName:"p"},"realm")," auquel le pont est rattach\xe9 ainsi que le token d'authentification utilis\xe9 pour s\xe9curiser les \xe9changes avec la plateforme."),(0,i.kt)("p",null,"Dans le cadre de la migration d'un serveur VPN en cours d'utilisation, il est \xe9galement possible de pointer un r\xe9pertoire contenant les configurations d\xe9j\xe0 existantes \xe0 utiliser."),(0,i.kt)("p",null,"Ainsi :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'realm: "wz01"\n# This token must be the same on the chatsubo plateform. "cat /dev/urandom | tr -dc \'a-zA-Z0-9\' | fold -w 128 | head -n 1" works well\nauth_token: "o9w3BxytyNfmmtsivUNcA3hfB3cB9b9KcogQHZU5cP775KaEZtaWANIpIndfA5ZZvGqV79PFDIV7i0IJsUEb58ahMLJDmLG7vTAosLqpURfrkdXKXC3ydlQFEMCvDwF9" \n\n# Optional\nclients_dir: "/opt/chatsubo-gate-wg/clients"  # Wireguard\n')),(0,i.kt)("h3",{id:"chatsubo"},"Chatsubo"),(0,i.kt)("p",null,"Du c\xf4t\xe9 de la plateforme, il faudra r\xe9percuter les donn\xe9es renseign\xe9es ci-dessus \xe0 l'identique, ainsi que l'url \xe0 utiliser pour joindre le pont VPN :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'vpns:\n - realm: "wz01"\n   url: "http://chatsubo.wz:7474"\n   token: "CHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEME"\n')),(0,i.kt)("h5",{id:"extensibilit\xe9"},"Extensibilit\xe9"),(0,i.kt)("p",null,"Afin de faciliter l'int\xe9gration de nouveaux connecteurs VPN, l'en-t\xeate utilis\xe9 pour l'authentification ainsi que les routes que la plateforme doit utiliser pour communiquer avec l'API du pont sont modifiable directement depuis le fichier de configuration :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'vpns:\n - realm: "wz01"\n   url: "http://chatsubo.wz:7474"\n   token: "CHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEME"\n\n   # Optional\n   header: "X-Chatsubo-Token"\n   endpoints:\n     config: "/api/vpn/get/:username"\n     check: "/api/check"\n')))}d.isMDXComponent=!0}}]);