(self.webpackChunkchatsubo=self.webpackChunkchatsubo||[]).push([[567],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),s=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,k=d["".concat(o,".").concat(m)]||d[m]||p[m]||i;return n?r.createElement(k,l(l({ref:t},c),{},{components:n})):r.createElement(k,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=d;var u={};for(var o in t)hasOwnProperty.call(t,o)&&(u[o]=t[o]);u.originalType=e,u.mdxType="string"==typeof e?e:a,l[1]=u;for(var s=2;s<i;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6259:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return c},default:function(){return d}});var r=n(2122),a=n(9756),i=(n(7294),n(3905)),l=["components"],u={},o="Installation",s={unversionedId:"Acc\xe8s VPN/installation",id:"Acc\xe8s VPN/installation",isDocsHomePage:!1,title:"Installation",description:"Pr\xe9requis",source:"@site/docs/30-Acc\xe8s VPN/10-installation.md",sourceDirName:"30-Acc\xe8s VPN",slug:"/Acc\xe8s VPN/installation",permalink:"/docs/Acc\xe8s VPN/installation",editUrl:"https://github.com/chatsuboctf/chatsubo/docs/30-Acc\xe8s VPN/10-installation.md",version:"current",sidebarPosition:10,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/docs/Acc\xe8s VPN/index"},next:{title:"Interface",permalink:"/docs/interface"}},c=[{value:"Pr\xe9requis",id:"pr\xe9requis",children:[]},{value:"WireGuard",id:"wireguard",children:[]},{value:"OpenVPN",id:"openvpn",children:[]},{value:"Routage inverse",id:"routage-inverse",children:[]}],p={toc:c};function d(e){var t=e.components,n=(0,a.Z)(e,l);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"installation"},"Installation"),(0,i.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,i.kt)("p",null,"Dans le cas o\xf9 un provider Docker est utilis\xe9, il faut d'abord cr\xe9er le r\xe9seau priv\xe9 auquel les ponts VPN et les instances cr\xe9\xe9es se connecteront."),(0,i.kt)("p",null,"Par convention, ce r\xe9seau doit se nommer ",(0,i.kt)("inlineCode",{parentName:"p"},"chatsugo-gate"),"."),(0,i.kt)("p",null,"Il se cr\xe9e gr\xe2ce \xe0 la commande :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker network create chatsubo-gate --subnet 10.10.10.0/24\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"L'utilisation du sous-r\xe9seau 10.10.10.0/24 est arbitraire. En revanche, il est important que plage IP indiqu\xe9e soit libre et ne chevauche pas celle utilis\xe9e pour les VPN.")),(0,i.kt)("h2",{id:"wireguard"},"WireGuard"),(0,i.kt)("p",null,"L'image Docker utilis\xe9e pour WireGuard est disponible sur ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/linuxserver/docker-wireguard"},"https://github.com/linuxserver/docker-wireguard")," (",(0,i.kt)("inlineCode",{parentName:"p"},"ghcr.io/linuxserver/wireguard"),")."),(0,i.kt)("p",null,"La mani\xe8re la plus simple de d\xe9ployer le pont VPN WireGuard est de remplir son fichier de configuration (cf. ",(0,i.kt)("a",{href:"/docs/Acc%C3%A8s%20VPN/index#pont-vpn"},"acc\xe8s-vpn/introduction"),") et de param\xe9trer le sous-r\xe9seau d\xe9sir\xe9 gr\xe2ce \xe0 un fichier ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," en renseignant les variables d'environnements suivantes :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"SERVERURL",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Nom d'h\xf4te ou adresse IP qui sera utilis\xe9e par le client des joueurs pour se connecter au serveur VPN"))),(0,i.kt)("li",{parentName:"ul"},"SERVERPORT",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Port externe sur lequel le serveur VPN est expos\xe9"))),(0,i.kt)("li",{parentName:"ul"},"PEERS",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"La quantit\xe9 de certificats \xe0 g\xe9n\xe9rer"))),(0,i.kt)("li",{parentName:"ul"},"INTERNAL_SUBNET",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Le sous-r\xe9seau du VPN"),(0,i.kt)("li",{parentName:"ul"},"Ex : 10.10.10.0"))),(0,i.kt)("li",{parentName:"ul"},"ALLOWEDIPS",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Les IP auxquels les clients ont acc\xe8s"),(0,i.kt)("li",{parentName:"ul"},"Par d\xe9faut : ",(0,i.kt)("inlineCode",{parentName:"li"},"0.0.0.0"))))),(0,i.kt)("p",null,"Puis de lancer les conteneurs :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/chatsuboctf/chatsubo-gate-wg\nvim config.yml  #] Update the gate's configuration\ndocker-compose up --build -d\n")),(0,i.kt)("p",null,"Exemple de fichier de configuration complet :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'realm: "wz"\nauth_token: "CHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEME"\nclients: "./clients"\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Les 254 certificats sont pr\xe9-g\xe9n\xe9r\xe9s au premier lancement du serveur ; cela peut prendre quelques minutes.")),(0,i.kt)("h2",{id:"openvpn"},"OpenVPN"),(0,i.kt)("p",null,"L'image Docker utilis\xe9e pour OpenVPN est disponible sur ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/kylemanna/docker-openvpn"},"https://github.com/kylemanna/docker-openvpn")," (",(0,i.kt)("inlineCode",{parentName:"p"},"kylemanna/docker-openvpn"),")."),(0,i.kt)("p",null,"Avant de lancer le serveur, il est n\xe9cessaire d'initialiser la PKI qui sera utilis\xe9e par OpenVPN."),(0,i.kt)("p",null,"Le script ",(0,i.kt)("inlineCode",{parentName:"p"},"scripts/init_pki.sh")," est mis \xe0 disposition afin de simplifier cette op\xe9ration."),(0,i.kt)("p",null,"Pour l'utiliser, il suffit de configurer les variable d'environnement suivantes puis de lancer le script :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HOST"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Nom d'h\xf4te ou adresse IP qui sera utilis\xe9e par le client des joueurs pour se connecter au serveur VPN"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"PORT"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Port externe sur lequel le serveur VPN est expos\xe9"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SUBNET"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Sous-r\xe9seau du VPN"),(0,i.kt)("li",{parentName:"ul"},"Ex : 10.10.10.0"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SUBNET_MASK"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Masque de sous-r\xe9seau du VPN"),(0,i.kt)("li",{parentName:"ul"},"Ex : 255.255.255.0")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Minimum configuration example\nexport HOST=vpn.hacklab.fr\nbash ./script/docker_cert.sh\n")),(0,i.kt)("p",null,"Le mot de passe de l'autorit\xe9 de certification vous sera demand\xe9 plusieurs fois. C'est \xe0 vous de le choisir la premi\xe8re fois qu'il est demand\xe9. Le conserver est important : il faudra le renseigner dans le fichier de configuration."),(0,i.kt)("p",null,"Les m\xe9tadonn\xe9es du certificat (Organization, Country, etc) peuvent \xeatre laiss\xe9es \xe0 leur valeur par d\xe9faut."),(0,i.kt)("p",null,"Une fois la PKI initialis\xe9e, il faudra remplir le fichier de configuration (cf. ",(0,i.kt)("a",{href:"/docs/Acc%C3%A8s%20VPN/index#pont-vpn"},"acc\xe8s-vpn/introduction"),") en rajoutant la clef ",(0,i.kt)("inlineCode",{parentName:"p"},"ca_pass")," contenant le mot de passe donn\xe9 lors de l'initialisation de la PKI, puis le lancer gr\xe2ce \xe0 Docker :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/chatsuboctf/chatsubo-gate-ovpn\nvim config.yml  #] Update the gate's configuration\nsudo docker-compose up --build -d\n")),(0,i.kt)("p",null,"Exemple de fichier de configuration complet :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'realm: "wz"\nauth_token: "CHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEMECHANGEME"\nca_pass: "changeme"\n')),(0,i.kt)("p",null,"Ce pont VPN a la particularit\xe9 d'utiliser Docker pour la g\xe9n\xe9ration et l'acc\xe8s aux certificats des joueurs. Il est donc n\xe9cessaire de lancer les conteneurs avec des privil\xe8ges \xe9lev\xe9s."),(0,i.kt)("h2",{id:"routage-inverse"},"Routage inverse"),(0,i.kt)("p",null,"Afin que les conteneurs puissent communiquer avec l'adresse IP du joueur fournie par le VPN, il est n\xe9cessaire d'ajouter la route \xe0 la table de routage gr\xe2ce \xe0 la commande :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo ip route add $VPN_USERS_SUBNET via $VPN_CONTAINER_ADDRESS\n\n# Ex : sudo ip route add 10.10.20.0/24 via 10.10.10.2\n")),(0,i.kt)("p",null,"O\xf9 ",(0,i.kt)("inlineCode",{parentName:"p"},"$VPN_USERS_SUBNET")," est le sous-r\xe9seau du VPN et ",(0,i.kt)("inlineCode",{parentName:"p"},"$VPN_CONTAINER_ADDRESS")," l'adresse IP du ",(0,i.kt)("strong",{parentName:"p"},"conteneur en charge du r\xe9seau VPN")," au sein du ",(0,i.kt)("strong",{parentName:"p"},"r\xe9seau docker ",(0,i.kt)("inlineCode",{parentName:"strong"},"chatsubo-gate")),"."),(0,i.kt)("p",null,"La commande suivante permet de r\xe9cup\xe9rer les adresses IP du conteneur VPN en cours d'ex\xe9cution :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"WireGuard",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"docker inspect -f '{{range.NetworkSettings.Networks}}|{{.IPAddress}}{{end}}' chatsubo-gate-wg_wireguard_1 | cut -d '|' -f 2")))),(0,i.kt)("li",{parentName:"ul"},"OpenVPN",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"docker inspect -f '{{range.NetworkSettings.Networks}}|{{.IPAddress}}{{end}}' chatsubo-gate-ovpn_openvpn_1 | cut -d '|' -f 2"))))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Le nom du conteneur (",(0,i.kt)("inlineCode",{parentName:"p"},"gate_wireguard_X"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"chatsubo-gate_openvpn_X"),") doit \xeatre modifi\xe9 dans le cas o\xf9 plusieurs instances du m\xeame pont sont actives simultan\xe9ment.")),(0,i.kt)("p",null,"L'IP au sein du r\xe9seau ",(0,i.kt)("inlineCode",{parentName:"p"},"chatsubo-gate")," est celle qui appartient \xe0 la plage d\xe9finie lors de la cr\xe9ation du sous-r\xe9seau Dockerk, soit ",(0,i.kt)("inlineCode",{parentName:"p"},"10.10.10.0/24")," dans l'exemple ci-dessus."))}d.isMDXComponent=!0}}]);